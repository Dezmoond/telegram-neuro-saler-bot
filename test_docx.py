#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOCX —Ñ–∞–π–ª–æ–≤
"""

import json
from datetime import datetime
from docx_generator import DocxGenerator

def test_docx_generation():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é DOCX —Ñ–∞–π–ª–∞"""
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞
    test_dialog = {
        "user_id": 123456789,
        "start_time": "2025-08-09T03:05:00",
        "end_time": "2025-08-09T03:10:00",
        "finish_reason": "success",
        "messages": [
            {
                "timestamp": "2025-08-09T03:05:00",
                "client_message": "–Ω–∞—á–∞–ª–æ –¥–∏–∞–ª–æ–≥–∞",
                "neuro_salesman_response": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. –≠—Ç–æ —É–∂–µ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤–∞—à–µ–≥–æ –Ω–∞–π–º–∞. –°–µ–π—á–∞—Å —Å–∞–º–æ–µ –≤—Ä–µ–º—è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å AI-—Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ –ø–æ–¥ –≤–∞—à–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏.",
                "agent_communication": {
                    "–ê–≥–µ–Ω—Ç-–≤–µ—Ç–∫–∏": "–≤—ã–±–∏—Ä–∞–µ–º –≤–µ—Ç–∫—É –ø—Ä–æ–¥–∞–∂–∏",
                    "–ê–≥–µ–Ω—Ç-–±–ª–æ–∫–∞": "–≤—ã–±–∏—Ä–∞–µ–º –±–ª–æ–∫ –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏",
                    "–ê–≥–µ–Ω—Ç-–ø—Ä–æ—Ñ–∞–π–ª–∞": "–Ω–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É —Å –±–ª–æ–∫–æ–º '–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏'",
                    "–§–∏–Ω–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç": "–∞–≥–µ–Ω—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤"
                }
            },
            {
                "timestamp": "2025-08-09T03:06:00",
                "client_message": "–ü—Ä–∏–≤–µ—Ç! –î–∞, –≤—Å–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏, –æ—á–µ–Ω—å –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å",
                "neuro_salesman_response": "–û—Ç–ª–∏—á–Ω–æ! –†–∞–¥, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å. –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ–¥–±–µ—Ä–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ. –°–∫–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏?",
                "agent_communication": {
                    "–ê–≥–µ–Ω—Ç-–≤–µ—Ç–∫–∏": "–≤–µ—Ç–∫–∞ –ø—Ä–æ–¥–∞–∂–∏",
                    "–ê–≥–µ–Ω—Ç-–±–ª–æ–∫–∞": "–±–ª–æ–∫ –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏",
                    "–ê–≥–µ–Ω—Ç-–ø—Ä–æ—Ñ–∞–π–ª–∞": "–æ–±–Ω–æ–≤–ª—è—é –ø—Ä–æ—Ñ–∏–ª—å: –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ",
                    "–§–∏–Ω–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç": "–∞–≥–µ–Ω—Ç-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤"
                }
            },
            {
                "timestamp": "2025-08-09T03:07:00",
                "client_message": "–£ –Ω–∞—Å 50 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",
                "neuro_salesman_response": "–û—Ç–ª–∏—á–Ω–æ! –î–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å 50 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ —É –Ω–∞—Å –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ö–∞–∫–æ–π —É –≤–∞—Å –±—é–¥–∂–µ—Ç –Ω–∞ HR –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é?",
                "agent_communication": {
                    "–ê–≥–µ–Ω—Ç-–≤–µ—Ç–∫–∏": "–≤–µ—Ç–∫–∞ –ø—Ä–æ–¥–∞–∂–∏",
                    "–ê–≥–µ–Ω—Ç-–±–ª–æ–∫–∞": "–±–ª–æ–∫ –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏",
                    "–ê–≥–µ–Ω—Ç-–ø—Ä–æ—Ñ–∞–π–ª–∞": "–æ–±–Ω–æ–≤–ª—è—é –ø—Ä–æ—Ñ–∏–ª—å: 50 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",
                    "–§–∏–Ω–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç": "–∞–≥–µ–Ω—Ç-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏"
                }
            },
            {
                "timestamp": "2025-08-09T03:08:00",
                "client_message": "–ë—é–¥–∂–µ—Ç –æ–∫–æ–ª–æ 100 —Ç—ã—Å—è—á –≤ –º–µ—Å—è—Ü",
                "neuro_salesman_response": "–ò–¥–µ–∞–ª—å–Ω–æ! –£ –Ω–∞—Å –µ—Å—Ç—å —Ç–∞—Ä–∏—Ñ '–ë–∏–∑–Ω–µ—Å' –∑–∞ 95 —Ç—ã—Å—è—á –≤ –º–µ—Å—è—Ü, –∫–æ—Ç–æ—Ä—ã–π –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏. –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏, –ø–ª—é—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É.",
                "agent_communication": {
                    "–ê–≥–µ–Ω—Ç-–≤–µ—Ç–∫–∏": "–≤–µ—Ç–∫–∞ –ø—Ä–æ–¥–∞–∂–∏",
                    "–ê–≥–µ–Ω—Ç-–±–ª–æ–∫–∞": "–±–ª–æ–∫ –î–æ–∂–∏–º–∞",
                    "–ê–≥–µ–Ω—Ç-–ø—Ä–æ—Ñ–∞–π–ª–∞": "–æ–±–Ω–æ–≤–ª—è—é –ø—Ä–æ—Ñ–∏–ª—å: –±—é–¥–∂–µ—Ç 100–∫/–º–µ—Å",
                    "–§–∏–Ω–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç": "–∞–≥–µ–Ω—Ç-–¥–æ–∂–∏–º–∞"
                }
            },
            {
                "timestamp": "2025-08-09T03:09:00",
                "client_message": "–î–∞–≤–∞–π—Ç–µ –æ—Ñ–æ—Ä–º–∏–º",
                "neuro_salesman_response": "–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ –æ—Ñ–æ—Ä–º–∏–º –¥–æ—Å—Ç—É–ø –∫ —Ç–∞—Ä–∏—Ñ—É '–ë–∏–∑–Ω–µ—Å'. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞–π–º–∞. –í–æ—Ç —Å—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã: [–û–ø–ª–∞—Ç–∏—Ç—å —Ç–∞—Ä–∏—Ñ '–ë–∏–∑–Ω–µ—Å'](https://example.com/payment). –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É –∏ —Å–º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, —è –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏!",
                "agent_communication": {
                    "–ê–≥–µ–Ω—Ç-–≤–µ—Ç–∫–∏": "–≤–µ—Ç–∫–∞ –ø—Ä–æ–¥–∞–∂–∏",
                    "–ê–≥–µ–Ω—Ç-–±–ª–æ–∫–∞": "–±–ª–æ–∫ –ó–∞–≤–µ—Ä—à–µ–Ω–∏—è",
                    "–ê–≥–µ–Ω—Ç-–ø—Ä–æ—Ñ–∞–π–ª–∞": "–ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω, –≥–æ—Ç–æ–≤ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é",
                    "–§–∏–Ω–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç": "–∞–≥–µ–Ω—Ç-–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"
                }
            }
        ]
    }
    
    # –°–æ–∑–¥–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä DOCX
    docx_gen = DocxGenerator()
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º DOCX —Ñ–∞–π–ª
    try:
        docx_filepath = docx_gen.create_dialog_docx(test_dialog["user_id"], test_dialog)
        print(f"‚úÖ DOCX —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {docx_filepath}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        import os
        if os.path.exists(docx_filepath):
            file_size = os.path.getsize(docx_filepath)
            print(f"üìÑ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {file_size} –±–∞–π—Ç")
            print(f"üìÅ –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É: {os.path.abspath(docx_filepath)}")
        else:
            print("‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω")
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ DOCX —Ñ–∞–π–ª–∞: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOCX —Ñ–∞–π–ª–æ–≤...")
    test_docx_generation()
    print("‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!")

